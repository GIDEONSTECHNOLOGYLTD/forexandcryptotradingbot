# ğŸš€ Deploy to Render - Complete Guide

## Why Render?

- âœ… **Free tier** available (enough to start)
- âœ… **Automatic deployments** from GitHub
- âœ… **Easy setup** (5-10 minutes)
- âœ… **No credit card** required for free tier
- âœ… **HTTPS** included
- âœ… **Better than Heroku** (free tier, easier)

**Cost:** 
- Free: $0/month (with limitations)
- Starter: $7/month per service (recommended)
- Total: ~$14/month for API + Worker

---

## ğŸ¯ Quick Deployment (10 Minutes)

### Step 1: Create Render Account

1. Go to https://render.com
2. Click "Get Started"
3. Sign up with GitHub (easiest)
4. Authorize Render to access your repos

### Step 2: Create MongoDB Atlas Database (Free)

```bash
# 1. Go to https://www.mongodb.com/cloud/atlas/register
# 2. Create free account
# 3. Create a cluster (free M0 tier)
# 4. Create database user:
#    - Username: tradingbot
#    - Password: <generate strong password>
# 5. Network Access: Add IP 0.0.0.0/0 (allow from anywhere)
# 6. Get connection string:
#    mongodb+srv://tradingbot:<password>@cluster0.xxxxx.mongodb.net/trading_bot
```

### Step 3: Deploy from Dashboard

**Option A: Blueprint (Recommended)**

```bash
# 1. Push render.yaml to your repo
git add render.yaml
git commit -m "Add Render deployment config"
git push

# 2. In Render Dashboard:
#    - Click "New +"
#    - Select "Blueprint"
#    - Connect your repo
#    - Select branch: main
#    - Render reads render.yaml automatically
#    - Click "Apply"

# 3. Set environment variables in Render Dashboard
#    (see Step 4 below)
```

**Option B: Manual Setup**

```bash
# 1. In Render Dashboard, click "New +"

# 2. Create Web Service (API):
#    - Name: trading-bot-api
#    - Repository: your-repo
#    - Branch: main
#    - Runtime: Python 3
#    - Build Command: pip install -r requirements.txt
#    - Start Command: uvicorn web_dashboard:app --host 0.0.0.0 --port $PORT
#    - Plan: Free or Starter ($7/mo)

# 3. Create Background Worker (Trading Bot):
#    - Name: trading-bot-worker
#    - Repository: your-repo
#    - Branch: main
#    - Runtime: Python 3
#    - Build Command: pip install -r requirements.txt
#    - Start Command: python advanced_trading_bot.py
#    - Plan: Free or Starter ($7/mo)
```

### Step 4: Configure Environment Variables

In Render Dashboard, for **both services**, add these environment variables:

```bash
# Database
MONGODB_URI=mongodb+srv://tradingbot:<password>@cluster0.xxxxx.mongodb.net/trading_bot

# OKX API (Your trading credentials)
OKX_API_KEY=your_okx_api_key
OKX_SECRET_KEY=your_okx_secret
OKX_PASSPHRASE=your_okx_passphrase

# JWT Secret (auto-generated by Render, or create your own)
JWT_SECRET_KEY=your_jwt_secret_here

# Stripe Payment (optional, for subscriptions)
STRIPE_SECRET_KEY=sk_test_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx

# PayStack (optional, for African payments)
PAYSTACK_SECRET_KEY=sk_test_xxx

# Crypto Payment (optional)
COINGATE_API_KEY=your_coingate_key

# Telegram Notifications (optional)
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id

# Trading Mode
PAPER_TRADING=True  # Set to False for live trading
```

### Step 5: Deploy!

```bash
# Render auto-deploys on git push!

# Make a change and push:
git add .
git commit -m "Deploy to Render"
git push

# Render will:
# 1. Detect the push
# 2. Build your app
# 3. Deploy automatically
# 4. Give you a URL: https://trading-bot-api.onrender.com
```

---

## ğŸ”§ Access Your Deployed App

### API Endpoint
```bash
# Your API will be available at:
https://trading-bot-api.onrender.com

# API Documentation:
https://trading-bot-api.onrender.com/docs

# Health Check:
https://trading-bot-api.onrender.com/health
```

### Update Mobile App

```bash
# Update mobile-app/.env
API_URL=https://trading-bot-api.onrender.com/api

# Or update mobile-app/src/services/api.ts:
const API_BASE_URL = 'https://trading-bot-api.onrender.com/api';
```

---

## ğŸ“Š Monitoring & Logs

### View Logs
```bash
# In Render Dashboard:
# 1. Click on your service
# 2. Click "Logs" tab
# 3. See real-time logs

# Or use Render CLI:
pip install render-cli
render logs trading-bot-api
```

### Metrics
```bash
# In Render Dashboard:
# - CPU usage
# - Memory usage
# - Request counts
# - Response times
```

---

## ğŸ’° Cost Breakdown

### Free Tier (Good for Testing)
```
Web Service: Free
  - Spins down after 15 min inactivity
  - Spins up on request (takes 30s)
  - 750 hours/month
  
Worker: Free
  - Runs continuously
  - 750 hours/month
  
Total: $0/month
Limitations: 
  - Slow spin-up
  - Limited resources
```

### Starter Tier (Recommended for Production)
```
Web Service: $7/month
  - Always on
  - Fast response
  - 512 MB RAM
  
Worker: $7/month
  - Always running
  - 512 MB RAM
  
Total: $14/month
Benefits:
  - Fast & reliable
  - No cold starts
  - Better for users
```

### Professional Tier (Scale)
```
Web Service: $25/month (1 GB RAM)
Worker: $25/month (1 GB RAM)
Total: $50/month

Use when: 100+ active users
```

---

## ğŸ” Security Setup

### Environment Variables
```bash
# NEVER commit these to git!
# Always set in Render Dashboard

# Required:
âœ… MONGODB_URI
âœ… OKX_API_KEY
âœ… OKX_SECRET_KEY
âœ… JWT_SECRET_KEY

# Optional but recommended:
âœ… STRIPE_SECRET_KEY
âœ… TELEGRAM_BOT_TOKEN
```

### HTTPS
```bash
# Render provides free HTTPS automatically
# Your API is secure by default:
https://trading-bot-api.onrender.com
```

---

## ğŸš¦ Health Checks

Add health check endpoint (already exists in `web_dashboard.py`):

```python
@app.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "timestamp": datetime.now().isoformat(),
        "version": "1.0.0"
    }
```

Configure in Render:
- Health Check Path: `/health`
- Auto-restart on failure: Yes

---

## ğŸ”„ Continuous Deployment

### Automatic Deploys
```bash
# Every git push triggers deployment:
git add .
git commit -m "New feature"
git push

# Render automatically:
# 1. Pulls latest code
# 2. Runs build command
# 3. Deploys new version
# 4. Zero-downtime deployment
```

### Manual Deploy
```bash
# In Render Dashboard:
# 1. Go to service
# 2. Click "Manual Deploy"
# 3. Select branch
# 4. Click "Deploy"
```

---

## âš¡ Performance Tips

### 1. Keep Services Warm (Free Tier)
```bash
# Use a cron job to ping your API every 10 minutes
# Prevents cold starts

# Add to cron-job.org or similar:
curl https://trading-bot-api.onrender.com/health
```

### 2. Use Starter Tier
```bash
# $7/month = always on, no cold starts
# Worth it for production use
```

### 3. Enable Caching
```bash
# Add Redis for caching (optional)
# Render offers Redis: $10/month
```

---

## ğŸ› Troubleshooting

### Build Failed
```bash
# Check logs in Render Dashboard
# Common issues:

# 1. Missing dependencies
# Fix: Update requirements.txt

# 2. Python version mismatch
# Fix: Specify in render.yaml:
PYTHON_VERSION=3.11.0

# 3. Environment variables missing
# Fix: Add in Render Dashboard
```

### Service Not Starting
```bash
# Check logs for errors
# Common issues:

# 1. MongoDB connection failed
# Fix: Check MONGODB_URI is correct

# 2. Port binding error
# Fix: Use $PORT variable (Render sets this)

# 3. Import errors
# Fix: pip install missing packages
```

### Slow Performance
```bash
# Free tier spins down after inactivity
# Solutions:

# 1. Upgrade to Starter ($7/mo)
# 2. Use keep-alive service
# 3. Accept 30s cold start
```

---

## ğŸ“± Connect Mobile App

### Update API URL
```typescript
// mobile-app/src/services/api.ts
const API_BASE_URL = 'https://trading-bot-api.onrender.com/api';
```

### Test Connection
```bash
# Test from mobile app:
curl https://trading-bot-api.onrender.com/health

# Should return:
{
  "status": "healthy",
  "timestamp": "2024-01-01T00:00:00",
  "version": "1.0.0"
}
```

---

## ğŸ‰ You're Live!

After deployment:

1. âœ… Backend running on Render
2. âœ… MongoDB Atlas connected
3. âœ… HTTPS enabled
4. âœ… Auto-deploys on push
5. âœ… Mobile app connected

**Your API URL:**
```
https://trading-bot-api.onrender.com
```

**Next Steps:**
1. Test all endpoints
2. Update mobile app
3. Start onboarding users!

---

## ğŸ’¡ Pro Tips

### 1. Custom Domain
```bash
# In Render Dashboard:
# Settings > Custom Domain
# Add: api.yourdomain.com
# Update DNS records as shown
```

### 2. Multiple Environments
```bash
# Create separate services:
# - trading-bot-api-staging (dev branch)
# - trading-bot-api-production (main branch)

# Different env vars for each
```

### 3. Database Backups
```bash
# MongoDB Atlas:
# - Auto-backups enabled
# - Point-in-time recovery
# - Free on M0 tier
```

---

## ğŸ“Š Render vs Others

| Feature | Render | Heroku | DigitalOcean | AWS |
|---------|--------|--------|--------------|-----|
| Free Tier | âœ… Yes | âŒ No | âŒ No | âš ï¸ Limited |
| Ease of Setup | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ | â­â­ |
| Auto Deploy | âœ… | âœ… | âŒ | âŒ |
| Price | $7/mo | $7/mo | $6/mo | $10+/mo |
| HTTPS | âœ… Free | âœ… Free | Extra $ | Extra $ |

**Winner:** Render for startups! ğŸ†

---

## âœ… Deployment Checklist

- [ ] Create Render account
- [ ] Create MongoDB Atlas cluster
- [ ] Push render.yaml to repo
- [ ] Create services in Render
- [ ] Set environment variables
- [ ] Test health endpoint
- [ ] Update mobile app API URL
- [ ] Test complete flow
- [ ] Monitor logs
- [ ] Upgrade to Starter tier (when ready)

**You're ready to deploy! Start with Step 1 above.** ğŸš€
